# Vim实用技巧

> 参考《Vim实用技巧》，对书中相关内容进行整理，以便长期参考。



# 第一章：Vim解决问题的方式

## 技巧2：不要自我重复

通过在行尾添加内容进行举例。

假设有如下JS程序片段：

```javascript
var foo = 1
var bar = 'a'
var foobar = foo + bar
```

解决的问题：**在每行的结尾添加一个分号**。

方法一： 先把光标移到行尾，然后进行修改。

`$` 命令将光标移到行尾，接着执行 `a;<Esc>` ，完成一行分号的添加。

因为`.` 命令可以重复上次的修改【也就是替代`a;<Esc>`】，我们不必重复之前的操作，而是执行两次`j$.` 便可以完成下一行的添加操作。

方法二：减少无关的移动。

`A`命令表示在当前行的添加内容。相当于将`$a` 封装成了一个按键操作。因此可以将方法一命令缩减。

`A;<Esc>`完成一行的添加。

`j.`完成下一行的重复添加。

>类似`A` 命令简化了 `$a` 命令这种方式，Vim中有很多例子。
>
>| 复合命令 | 等效长命令 |
>| -------- | ---------- |
>| C        | c$         |
>| s        | cl         |
>| S        | ^c         |
>| I        | ^i         |
>| A        | $a         |
>| o        | A<CR>      |
>| O        | ko         |

假设我们需要给连续50行的添加分号，每一行的修改输入一次`j.`，非常麻烦。

解决方案：**技巧30 在指定范围上执行普通模式命令**。

在一系列连续行上执行一条 **普通模式命令**，可以使用`:normal`命令。该命令与`.`命令或宏结合使用时，可以快速完成大量重复性的任务。

`A;<Esc>` 对一行进行添加。

`jVG ` 对剩余内容进行高亮显示。

`:'<,'>normal .` 对高亮选区中的每一行，对其执行普通模式下的`.`命令。

改进：
`:%normal A;` %代表整个文件的范围，即告诉Vim在文件每行的结尾添加一个分号。修改时会切入到插入模式，但修改完后Vim会自动返回普通模式。

拓展：执行`:normal i//` 命令可以把整行文件注释。



## 技巧3：以退为进

有如下代码：

```javascript
var foo = "method("+argument1+","+argument2+")";
```

问题：在上面代码中的每一个`+`前后加一个空格，符合格式要求。

```javascript
var foo = "method(" + argument1 + "," + argument2 + ")";
```

使修改可重复

`f+`：找到第一个+号。

`s + <Esc>`：s命令先删除光标下的字符，然后进入插入模式。  【以退为进。方便使用`.`操作进行重复】

`;`：重复查找下一个+号。

`.`：重复修改。

`;. `：重复修改。

`;.`：重复修改。



## 技巧4： 执行、重复、回退

在面对重复性工作时，我们需要让移动动作和修改都能够重复，这样可以达到一个最佳编辑模式。

可重复操作及如何回退：

| 目的                     | 操作                   | 重复 | 回退 |
| ------------------------ | ---------------------- | ---- | ---- |
| 做出一个修改             | {edit}                 | .    | u    |
| 在行内查找下一个指定字符 | f{char}/t{char}        | ;    | ,    |
| 在行内查找上一个指定字符 | F{char}/T{char}        | ;    | ,    |
| 在文档中查找下一处匹配项 | /pattern<CR>           | n    | N    |
| 在文档中查找上一处匹配项 | ?pattern<CR>           | n    | N    |
| 执行替换                 | : s/target/replacement | &    | u    |
| 执行一系列修改           | qx{change}q            | @x   | u    |



## 【替换】 技巧5：查找并手动替换  & 技巧89 手动控制每一次替换操作

Vim提供了一个：substitute命令专门用于查找替换任务。

```txt
... We're waiting for content before the site can go live...
... If you are content with this, let's go ahead with it...
... We'll launch as soon as we have the content...
```

问题：想用单词copy替代content。

如果想要全部替换，则使用substitute命令进行替换即可。`:%s/content/copy/g`

倘若我们需要仔细检查每一处替换处是否需要进行替换。

解决方案：
我们可以调出查找提示符，并输入完整的单词来查找“content”。

`/content`：光标移动到content上。

`*`：对当前光标所在位置进行处的单词进行查找，并高亮。光标会跳到下一个匹配项中，且所有出现这个词的地方都会进行高亮。 如果没有出现高亮，使用`:set hls`设置。

`cwcopy<Esc>`：将content替换为copy。  注：使用该方法主要使修改可重复。

`n`：跳到下一个匹配项，也就是content。

`.`：重复上一次替换，将content替换为copy。

不断重复...



## 总结

以上几个简单的任务主要介绍了如何高效实用`.`命令去解决问题。可以称为"`.`范式"。

在三个技巧中，在完成重复操作后，分别使用`j.`、`;.`、`n.`，即可对相关任务进行重复操作。

使用Vim的理想模式：用一键移动，另一键执行。【**需要掌握的思想**】

所有这些例子都利用`.`命令重复上次的修改。其次就是他们都只需要按一次键就能够把光标移到下一个目标还是那个。一次按键移动，一次按键执行，这就是我们的理想解决方案。



# 第二章 普通模式

## 技巧9：构造可重复的修改

在Vim中，完成一项修改不止一种方式，因此在完成相同任务时效率便成了很重要的一个标准。

下例中，假设光标位于行尾字符“h”处，要删除单词“nigh”：

```txt
The end is nigh
```

1. 反向删除

`db`: `The end is h ` db命令删除光标起始位置到单词开头的内容，但留下字符h。

`x`: 使用x删除剩余的h字符。

2. 正向删除

`b`: 使用`b`命令把光标移到单词开头。

`dw`: 使用`dw`命令删除整个单词。

3. 删除整个单词

`daw`: 删除光标所在单词，可以简单记为："delete a word"

以上三种方式，在VimGolf中评分均为3分。那么那种方式最高效？

通过`.`命令判断，在执行删除命令后，使用`.`操作。

方法一：`.` == `x`

方法二：`.` == `dw`

方法三：`.` == `daw`

其中最后意义的便是方法三，可以重复上次删除操作。因此使用`daw`进行单词删除更高效。



## 技巧10: 用次数做简单的算数运算

`<C - a>` 和 `<C - x>` 命令分别对数字进行加减操作。如果将光标放到字符5上，执行`10<C - a>`，会把当前字符加上10，变为15。

```css
.blog, .news { background-image: url(/sprite.png); }
.blog { background-position: 0px 0px }
```

复制最后一行并执行两个动作:

1. 使用`news`替换`blog`。
2. 把`0px`改为`180px`。

使用`yyp`和`cw`修改第一个单词。

问题在于：**处理数值**

一般使用`f0`跳到树枝，然后进入插入模式手动修改值，即`i-18<Esc>`。

但使用`180<C - x>`会更快，命令会自动跳到第一个数字上，然后对其进行操作。



## 第三章：插入模式

插入模式时按键操作：

| 按键操作 | 用途                   |
| -------- | ---------------------- |
| `<C-h>`  | 删除前一个字符，即退格 |
| `<C-w>`  | 删除前一个单词         |
| `<C-u>`  | 删至行首               |

* 插入模式专注于做一件事：输入问题
* 普通模式却是我们大部分时间所使用的模式。【快速在两者之间切换很重要】

## 技巧15： 不离开插入模式，粘贴寄存器中的文本

```txt
Practical Vim, by Drew Neil
Read Drew Neil's 
```

目的：将书名插入到最后一行。

`yt,`：光标位于第一行P位置。 将“Practical Vim”复制到专用寄存器中。

`jA`：跳到下一行行尾。

`<C-r>0`:将寄存器中内容复制出来。

`.<Esc>`：Done。

其中`<C-r>{register}`，中，{register}是我们想要插入寄存器的名字。





## 第四章：可视模式

Vim有三种不同的可视模式，分别用于操作字符文本、行文本或块文本。

| 命令    | 用途                                                         |
| ------- | ------------------------------------------------------------ |
| `v`     | 激活面向字符的可视模式                                       |
| `V`     | 激活面向行的可视模式                                         |
| `<C-v>` | 激活面向块的可视模式                                         |
| `gv`    | 重选上次的高亮选区【不管上个选区是面向字符的、面向行的，或是面向列块的，`gv`命令都能够正确的工作。 |

### 技巧26： 在长短不一的高亮块后添加文本

以下JavaScript代码：

```javascript
var foo = 1
var bar = 'a'
var foobar = foo + bar
```

目的：在每行结尾添加一个分号。

Normal mode下光标位于1位置。

`<C-v>jj$`: 进入Visual-Block模式，选中到文本末端。

`A;`：返回Insert mode，在第一行末加分号。

`<Esc>`：返回Normal mode后会发现修改扩散在其余的行中。





----

## Reference

[VimGolf](https://www.vimgolf.com/)

