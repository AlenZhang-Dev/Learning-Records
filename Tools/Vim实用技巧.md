# Vim实用技巧

> 参考《Vim实用技巧》，对书中相关内容进行整理，以便长期参考。



# 第一章：Vim解决问题的方式

## 技巧2：不要自我重复

通过在行尾添加内容进行举例。

假设有如下JS程序片段：

```javascript
var foo = 1
var bar = 'a'
var foobar = foo + bar
```

解决的问题：**在每行的结尾添加一个分号**。

方法一： 先把光标移到行尾，然后进行修改。

`$` 命令将光标移到行尾，接着执行 `a;<Esc>` ，完成一行分号的添加。

因为`.` 命令可以重复上次的修改【也就是替代`a;<Esc>`】，我们不必重复之前的操作，而是执行两次`j$.` 便可以完成下一行的添加操作。

方法二：减少无关的移动。

`A`命令表示在当前行的添加内容。相当于将`$a` 封装成了一个按键操作。因此可以将方法一命令缩减。

`A;<Esc>`完成一行的添加。

`j.`完成下一行的重复添加。

>类似`A` 命令简化了 `$a` 命令这种方式，Vim中有很多例子。
>
>| 复合命令 | 等效长命令 |
>| -------- | ---------- |
>| C        | c$         |
>| s        | cl         |
>| S        | ^c         |
>| I        | ^i         |
>| A        | $a         |
>| o        | A<CR>      |
>| O        | ko         |

假设我们需要给连续50行的添加分号，每一行的修改输入一次`j.`，非常麻烦。

解决方案：**技巧30 在指定范围上执行普通模式命令**。

在一系列连续行上执行一条 **普通模式命令**，可以使用`:normal`命令。该命令与`.`命令或宏结合使用时，可以快速完成大量重复性的任务。

`A;<Esc>` 对一行进行添加。

`jVG ` 对剩余内容进行高亮显示。

`:'<,'>normal .` 对高亮选区中的每一行，对其执行普通模式下的`.`命令。

改进：
`:%normal A;` %代表整个文件的范围，即告诉Vim在文件每行的结尾添加一个分号。修改时会切入到插入模式，但修改完后Vim会自动返回普通模式。

拓展：执行`:normal i//` 命令可以把整行文件注释。



## 技巧3：以退为进

有如下代码：

```javascript
var foo = "method("+argument1+","+argument2+")";
```

问题：在上面代码中的每一个`+`前后加一个空格，符合格式要求。

```javascript
var foo = "method(" + argument1 + "," + argument2 + ")";
```

使修改可重复

`f+`：找到第一个+号。

`s + <Esc>`：s命令先删除光标下的字符，然后进入插入模式。  【以退为进。方便使用`.`操作进行重复】

`;`：重复查找下一个+号。

`.`：重复修改。

`;. `：重复修改。

`;.`：重复修改。



## 技巧4： 执行、重复、回退

在面对重复性工作时，我们需要让移动动作和修改都能够重复，这样可以达到一个最佳编辑模式。

可重复操作及如何回退：

| 目的                     | 操作                   | 重复 | 回退 |
| ------------------------ | ---------------------- | ---- | ---- |
| 做出一个修改             | {edit}                 | .    | u    |
| 在行内查找下一个指定字符 | f{char}/t{char}        | ;    | ,    |
| 在行内查找上一个指定字符 | F{char}/T{char}        | ;    | ,    |
| 在文档中查找下一处匹配项 | /pattern<CR>           | n    | N    |
| 在文档中查找上一处匹配项 | ?pattern<CR>           | n    | N    |
| 执行替换                 | : s/target/replacement | &    | u    |
| 执行一系列修改           | qx{change}q            | @x   | u    |



## 【替换】 技巧5：查找并手动替换  & 技巧89 手动控制每一次替换操作

Vim提供了一个：substitute命令专门用于查找替换任务。

```txt
... We're waiting for content before the site can go live...
... If you are content with this, let's go ahead with it...
... We'll launch as soon as we have the content...
```

问题：想用单词copy替代content。

如果想要全部替换，则使用substitute命令进行替换即可。`:%s/content/copy/g`

倘若我们需要仔细检查每一处替换处是否需要进行替换。

解决方案：
我们可以调出查找提示符，并输入完整的单词来查找“content”。

`/content`：光标移动到content上。

`*`：对当前光标所在位置进行处的单词进行查找，并高亮。光标会跳到下一个匹配项中，且所有出现这个词的地方都会进行高亮。 如果没有出现高亮，使用`:set hls`设置。

`cwcopy<Esc>`：将content替换为copy。  注：使用该方法主要使修改可重复。

`n`：跳到下一个匹配项，也就是content。

`.`：重复上一次替换，将content替换为copy。

不断重复...



## 总结

以上几个简单的任务主要介绍了如何高效实用`.`命令去解决问题。可以称为"`.`范式"。

在三个技巧中，在完成重复操作后，分别使用`j.`、`;.`、`n.`，即可对相关任务进行重复操作。

使用Vim的理想模式：用一键移动，另一键执行。【**需要掌握的思想**】

所有这些例子都利用`.`命令重复上次的修改。其次就是他们都只需要按一次键就能够把光标移到下一个目标还是那个。一次按键移动，一次按键执行，这就是我们的理想解决方案。